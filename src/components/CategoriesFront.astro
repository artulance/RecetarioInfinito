---
import { getCollection } from 'astro:content';

// Predefined category metadata (icon + color)
const categoryDefs = [
  { id: 'desayunos', icon: 'coffee', name: 'Desayunos', color: 'bg-orange-100 text-orange-600' },
  { id: 'platos-principales', icon: 'pizza', name: 'Platos Principales', color: 'bg-red-100 text-red-600' },
  { id: 'sopas', icon: 'soup', name: 'Sopas', color: 'bg-yellow-100 text-yellow-600' },
  { id: 'ensaladas', icon: 'salad', name: 'Ensaladas', color: 'bg-green-100 text-green-600' },
  { id: 'postres', icon: 'cake', name: 'Postres', color: 'bg-pink-100 text-pink-600' },
  { id: 'bebidas', icon: 'drink', name: 'Bebidas', color: 'bg-blue-100 text-blue-600' },
  { id: 'pescado', icon: 'fish', name: 'Pescados', color: 'bg-blue-100 text-blue-600' },
  { id: 'vegetarian', icon: 'vegetarian', name: 'Vegetarianos', color: 'bg-blue-100 text-blue-600' },
];

const getIcon = (name: string) => {
  const icons: Record<string, string> = {
    coffee: '<path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h12a4 4 0 0 1 4 4"/><path d="M12 5c0-1.657.895-3 2-3s2 1.343 2 3"/><path d="M3.17 9L8 14m0 0l4.83 5M8 14l-4.83-5M8 14l4.83 5"/>',
    pizza: '<path d="M12 2L2 7v10a10 10 0 0 0 10 10 10 10 0 0 0 10-10V7z"/><path d="M12 2v20M2 7h20M12 12l-5 5M12 12l5 5"/>',
    soup: '<path d="M12 2c-5.33 0-9 1.79-9 4v12c0 2.21 3.67 4 9 4s9-1.79 9-4V6c0-2.21-3.67-4-9-4Z"/><path d="M3 6h18M9 12h2M8 16h4M7 20h5"/>',
    salad: '<path d="M7 11h10m-5-6V2m-8 9a7 7 0 1 0 14 0H4z"/><path d="M9 15l2 2 4-4"/>',
    cake: '<path d="M12 2v6m-5-4a3 3 0 0 0-3 3v8a4 4 0 0 0 4 4h6a4 4 0 0 0 4-4v-8a3 3 0 0 0-3-3M8 6h8M8 12h8M8 18h8"/>',
    drink: '<path d="M6.4 14.4V20a2 2 0 0 0 2 2h7.2a2 2 0 0 0 2-2v-5.6M6.4 14.4h11.2M6.4 14.4L9.7 7h4.6L15.6 14.4M9.7 7L11 4h2l1.3 3M11 11h2"/>',
    fish: '<path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.69 7.44a6.973 6.973 0 0 0 -1.69 4.56c0 1.747 .64 3.345 1.699 4.571" /><path d="M2 9.504c7.715 8.647 14.75 10.265 20 2.498c-5.25 -7.761 -12.285 -6.142 -20 2.504" /><path d="M18 11v.01" /><path d="M11.5 10.5c-.667 1 -.667 2 0 3" />',
    vegetarian: '<path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 11h16a1 1 0 0 1 1 1v.5c0 1.5 -2.517 5.573 -4 6.5v1a1 1 0 0 1 -1 1h-8a1 1 0 0 1 -1 -1v-1c-1.687 -1.054 -4 -5 -4 -6.5v-.5a1 1 0 0 1 1 -1z" /><path d="M18.5 11c.351 -1.017 .426 -2.236 .5 -3.714v-1.286h-2.256c-2.83 0 -4.616 .804 -5.64 2.076" /><path d="M5.255 11.008a12.204 12.204 0 0 1 -.255 -2.008v-1h1.755c.98 0 1.801 .124 2.479 .35" /><path d="M8 8l1 -4l4 2.5" /><path d="M13 11v-.5a2.5 2.5 0 1 0 -5 0v.5" />',
  };
  return icons[name] || icons.coffee;
};

import { slugify } from '../lib/slugify';

// Gather categories found in content (no counts, just ensure unknown categories appear)
const posts = await getCollection('recetas');
const found: Record<string, string> = {}; // slug -> display name (first occurrence)
for (const p of posts) {
  const cats = Array.isArray(p.data.categories) ? p.data.categories : p.data.categories ? [p.data.categories] : [];
  for (const c of cats) {
    const name = String(c).trim();
    if (!name) continue;
    found[slugify(name)] ||= name;
  }
}

// Build final categories array: start with predefined, then append any found that are not defined
const categories = [...categoryDefs];
for (const [id, name] of Object.entries(found)) {
  if (!categories.some(c => c.id && c.id.toLowerCase() === id)) {
    categories.push({ id, icon: 'drink', name, color: 'bg-gray-100 text-gray-700' });
  }
}

// Optional: sort alphabetically
categories.sort((a, b) => a.name.localeCompare(b.name));
---
<section class="py-20 bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <h2 class="text-4xl font-bold text-gray-900 mb-4">Explora por Categorías</h2>
      <p class="text-xl text-gray-600 max-w-2xl mx-auto">Encuentra exactamente lo que buscas navegando por nuestras categorías</p>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6">
      {categories.map((category) => (
        <a href={`/categoria/${category.id}`} class="bg-white rounded-2xl p-6 text-center hover:shadow-xl transition-all transform hover:-translate-y-2 cursor-pointer category-filter" aria-label={`Ver recetas de ${category.name}`}>
          <div class={`inline-flex items-center justify-center w-16 h-16 ${category.color} rounded-xl mb-4`}>
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8" set:html={getIcon(category.icon)}></svg>
          </div>
          <h3 class="font-semibold text-gray-900 mb-1">{category.name}</h3>
        </a>
      ))}
    </div>
  </div>
</section>
